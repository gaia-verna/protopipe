

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>mva &mdash; protopipe 0.3.0-dev0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="get_evt_model_output" href="../api/protopipe.mva.get_evt_model_output.html" />
    <link rel="prev" title="bcolors" href="../api/protopipe.pipeline.bcolors.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> protopipe
          

          
          </a>

          
            
            
              <div class="version">
                0.3.0-dev0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">Workflow and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contribute/index.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../AUTHORS.html">Authors</a></li>
</ul>
<p class="caption"><span class="caption-text">Structure</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../pipeline/index.html">pipeline</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">mva</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#details">Details</a></li>
<li class="toctree-l2"><a class="reference internal" href="#proposals-for-improvements-and-or-fixes">Proposals for improvements and/or fixes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#reference-api">Reference/API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-protopipe.mva">protopipe.mva Package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#functions">Functions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.get_evt_model_output.html">get_evt_model_output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.get_evt_subarray_model_output.html">get_evt_subarray_model_output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.load_obj.html">load_obj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.make_cut_list.html">make_cut_list</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.plot_distributions.html">plot_distributions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.plot_hist.html">plot_hist</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.plot_profile.html">plot_profile</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.plot_roc_curve.html">plot_roc_curve</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.prepare_data.html">prepare_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.save_obj.html">save_obj</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.split_train_test.html">split_train_test</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#classes">Classes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.BoostedDecisionTreeDiagnostic.html">BoostedDecisionTreeDiagnostic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.ClassifierDiagnostic.html">ClassifierDiagnostic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.ModelDiagnostic.html">ModelDiagnostic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.RegressorDiagnostic.html">RegressorDiagnostic</a></li>
<li class="toctree-l4"><a class="reference internal" href="../api/protopipe.mva.TrainModel.html">TrainModel</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../perf/index.html">perf</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scripts/index.html">scripts</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">protopipe</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>mva</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/mva/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="mva">
<span id="id1"></span><h1>mva<a class="headerlink" href="#mva" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p><cite>protopipe.mva</cite> contains utilities to build models for regression or
classification problems. It is based on machine learning methods available in
<a class="reference external" href="https://scikit-learn.org/">scikit-learn</a>. Internally, the tables are dealt with the <a class="reference external" href="https://pandas.pydata.org/">Pandas</a> Python module.</p>
<p>For each type of camera a regressor/classifier should be trained. For both type of models
an average of the image estimates is later computed to determine a global
output for the event (energy or score/gammaness).</p>
</div>
<div class="section" id="details">
<h2>Details<a class="headerlink" href="#details" title="Permalink to this headline">¶</a></h2>
<p>The class <cite>TrainModel</cite> uses a training sample composed of gamma-rays for a
regression model. In addition of a gamma-ray sample, a sample of
protons is also used to build a classifier. The training of a model is done via
the <a class="reference external" href="https://scikit-learn.org/stable/modules/grid_search.html">GridSearchCV</a> algorithm which allows to find the best hyper-parameters of
the models.</p>
<p>The RegressorDiagnostic and ClassifierDiagnostic classes can be used to generate
several diagnostic plots for regression and classification models, respectively.</p>
</div>
<div class="section" id="proposals-for-improvements-and-or-fixes">
<h2>Proposals for improvements and/or fixes<a class="headerlink" href="#proposals-for-improvements-and-or-fixes" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section has to be moved to the repository as a set of issues.</p>
</div>
<ul class="simple">
<li><p>Improve split of training/test data. For now the split of the data is done
according to the run number, e.g. training data will be N% of the first runs
(sorted by run numbers) and test data will be the remaining runs. Really easy
to improve with scikit-learn. But I wanted to keep the information about evt_id and
the obs_id in order to combine the data and produce diagnostic plot at the
level of event (not implemented yet), which is more complex that what scikit does.</p></li>
<li><p>Implement event-level diagnostic.</p></li>
<li><p>To train the energy estimator, the Boosted Decision Tree method is hard-coded.</p></li>
<li><p>For the diagnostic, in both case we might want to implement diagnostics
at the level of events but for this we need to link the event Id with the
observation Id as well as the image parameters to split and combine the
model output. It needs some thoughts…</p></li>
</ul>
</div>
<div class="section" id="reference-api">
<h2>Reference/API<a class="headerlink" href="#reference-api" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-protopipe.mva">
<span id="protopipe-mva-package"></span><h2>protopipe.mva Package<a class="headerlink" href="#module-protopipe.mva" title="Permalink to this headline">¶</a></h2>
<p>Classes to buil models based on machine learning methods.</p>
<div class="section" id="functions">
<h3>Functions<a class="headerlink" href="#functions" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.get_evt_model_output.html#protopipe.mva.get_evt_model_output" title="protopipe.mva.get_evt_model_output"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_evt_model_output</span></code></a>(data_dict[, …])</p></td>
<td><p>Returns DataStore with reco energy + score/target columns of model at the level-event.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.get_evt_subarray_model_output.html#protopipe.mva.get_evt_subarray_model_output" title="protopipe.mva.get_evt_subarray_model_output"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_evt_subarray_model_output</span></code></a>(data[, …])</p></td>
<td><p>Returns DataStore with keepcols + score/target columns of model at the level-subarray-event.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.load_obj.html#protopipe.mva.load_obj" title="protopipe.mva.load_obj"><code class="xref py py-obj docutils literal notranslate"><span class="pre">load_obj</span></code></a>(name)</p></td>
<td><p>Load object in binary</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.make_cut_list.html#protopipe.mva.make_cut_list" title="protopipe.mva.make_cut_list"><code class="xref py py-obj docutils literal notranslate"><span class="pre">make_cut_list</span></code></a>(cuts)</p></td>
<td><p></p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.plot_distributions.html#protopipe.mva.plot_distributions" title="protopipe.mva.plot_distributions"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_distributions</span></code></a>(feature_list, data_list)</p></td>
<td><p>Plot feature distributions for several data set.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.plot_hist.html#protopipe.mva.plot_hist" title="protopipe.mva.plot_hist"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_hist</span></code></a>(ax, data, nbin, limit[, norm, …])</p></td>
<td><p>Utility function to plot histogram</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.plot_profile.html#protopipe.mva.plot_profile" title="protopipe.mva.plot_profile"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_profile</span></code></a>(ax, data, xcol, ycol, nbin, limit)</p></td>
<td><p>Plot profile of a distribution</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.plot_roc_curve.html#protopipe.mva.plot_roc_curve" title="protopipe.mva.plot_roc_curve"><code class="xref py py-obj docutils literal notranslate"><span class="pre">plot_roc_curve</span></code></a>(ax, model_output, y, **kwargs)</p></td>
<td><p>Plot ROC curve for a given set of model outputs and labels</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.prepare_data.html#protopipe.mva.prepare_data" title="protopipe.mva.prepare_data"><code class="xref py py-obj docutils literal notranslate"><span class="pre">prepare_data</span></code></a>(ds, cuts[, label])</p></td>
<td><p>Add variables in data frame</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.save_obj.html#protopipe.mva.save_obj" title="protopipe.mva.save_obj"><code class="xref py py-obj docutils literal notranslate"><span class="pre">save_obj</span></code></a>(obj, name)</p></td>
<td><p>Save object in binary</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.split_train_test.html#protopipe.mva.split_train_test" title="protopipe.mva.split_train_test"><code class="xref py py-obj docutils literal notranslate"><span class="pre">split_train_test</span></code></a>(ds, train_fraction, …)</p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="classes">
<h3>Classes<a class="headerlink" href="#classes" title="Permalink to this headline">¶</a></h3>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.BoostedDecisionTreeDiagnostic.html#protopipe.mva.BoostedDecisionTreeDiagnostic" title="protopipe.mva.BoostedDecisionTreeDiagnostic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">BoostedDecisionTreeDiagnostic</span></code></a></p></td>
<td><p>Class producing diagnostic plot for the BDT method</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.ClassifierDiagnostic.html#protopipe.mva.ClassifierDiagnostic" title="protopipe.mva.ClassifierDiagnostic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ClassifierDiagnostic</span></code></a>(model, …[, …])</p></td>
<td><p>Class to plot several diagnostic plot for classification.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.ModelDiagnostic.html#protopipe.mva.ModelDiagnostic" title="protopipe.mva.ModelDiagnostic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ModelDiagnostic</span></code></a>(model, feature_name_list, …)</p></td>
<td><p>Base class for model diagnostics.</p></td>
</tr>
<tr class="row-even"><td><p><a class="reference internal" href="../api/protopipe.mva.RegressorDiagnostic.html#protopipe.mva.RegressorDiagnostic" title="protopipe.mva.RegressorDiagnostic"><code class="xref py py-obj docutils literal notranslate"><span class="pre">RegressorDiagnostic</span></code></a>(model, …)</p></td>
<td><p>Class to plot several diagnostic plot for regression</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="../api/protopipe.mva.TrainModel.html#protopipe.mva.TrainModel" title="protopipe.mva.TrainModel"><code class="xref py py-obj docutils literal notranslate"><span class="pre">TrainModel</span></code></a>(case, feature_name_list[, …])</p></td>
<td><p>Train classification or regressor model.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../api/protopipe.mva.get_evt_model_output.html" class="btn btn-neutral float-right" title="get_evt_model_output" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../api/protopipe.pipeline.bcolors.html" class="btn btn-neutral float-left" title="bcolors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, Michele Peresano

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>